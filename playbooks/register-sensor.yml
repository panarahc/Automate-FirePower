# A simple playbook to register the manager with the sensor and then configure the sensor on the manager. A convoluted process made easy!
# I've only tested this on the sensor, not the manager. It 'should' work but needs to be validated.
---
- hosts: FirePower_Sensors
  remote_user: "{{ user }}"
  tasks:
  # Register Manager to Sensor
  - name: Register Manager
    become: true
    shell: /usr/local/sf/bin/sfcli.pl isto managed {{ manager_ip }} {{ manager_key }}

  # Register Sensor to Manager
  - name: Register Sensor
    become: true
    shell: /usr/local/sf/bin/register_appliance.pl -h {{ inventory_hostname }} -k {{ manager_key }} -a {{ appliancetype }} -p {{ policy }} -l {{ license }}
    delegate_to: "{{ manager_ip }}"
